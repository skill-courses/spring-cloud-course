# Spring Security 异常处理

![Spring-security-exception](../../images/spring-security/spring-security-exception.jpg)

异常处理是任何框架都需要考虑的东西，Spring Security的异常也不例外，今天我们就来简单了解它。

## Spring Security的异常分类

在 Spring Security 的过滤器链中，ExceptionTranslationFilter 过滤器专门用来处理异常，在 ExceptionTranslationFilter 中，我们可以看到，异常被分为了两大类：认证异常和授权异常，两种异常分别由不同的回调函数来处理。

![spring-security-categery](../../images/spring-security/spring-security-categry.jpg)

## Spring Security的异常处理逻辑

我们在使用Spring Security时，自定义配置类继承自WebSecurityConfigurerAdapter并重写的`configure(HttpSecurity http)`方法就是在这里调用的，换句话说，当我们去配置HttpSecurity时，其实它已经完成了一波初始化了。

在默认的 HttpSecurity 初始化的过程中，调用`exceptionHandling`方法，这个方法会将ExceptionHandlingConfigurer配置进来，最终调用`ExceptionHandlingConfigurer#configure`方法将ExceptionTranslationFilter 添加到Spring Security过滤器链中。

```java
@Override
public void configure(H http) {
    AuthenticationEntryPoint entryPoint = getAuthenticationEntryPoint(http);
    ExceptionTranslationFilter exceptionTranslationFilter = new ExceptionTranslationFilter(
            entryPoint, getRequestCache(http));
    AccessDeniedHandler deniedHandler = getAccessDeniedHandler(http);
    exceptionTranslationFilter.setAccessDeniedHandler(deniedHandler);
    exceptionTranslationFilter = postProcess(exceptionTranslationFilter);
    http.addFilter(exceptionTranslationFilter);
}
```

可以看到，这里构造了两个对象传入到 ExceptionTranslationFilter 中：
* AuthenticationEntryPoint: 这个用来处理认证异常。
* AccessDeniedHandler: 这个用来处理授权异常。

然后调用`postProcess`方法把`ExceptionTranslationFilter`过滤器注册到Spring容器中，最后调用`addFilter`方法将其添加在Spring Security过滤器链中

## 自定义异常

1.http://www.javaboy.org/2020/0630/springsecurity-exception.html