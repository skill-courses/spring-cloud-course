# Spring Security认证管理器

![spring-security-authentication](../../images/spring-security/spring-security-authentication.jpeg)

上一节课程的学习可以知道，完成Spring Security的认证有两个重要的部分：**过滤器(Filter)** 和**认证管理器(AuthenticationManager)**， 上节课我们已经学习了过滤器，这节课我们就来学习认证管理器吧。

## 概述

从`UsernamePasswordAuthenticationFilter`里面的方法`attemptAuthentication`中，我们了解到：
```java
public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)
        throws AuthenticationException {
    if (this.postOnly && !request.getMethod().equals("POST")) {
        throw new AuthenticationServiceException("Authentication method not supported: " + request.getMethod());
    }
    String username = obtainUsername(request);
    username = (username != null) ? username : "";
    username = username.trim();
    String password = obtainPassword(request);
    password = (password != null) ? password : "";
    UsernamePasswordAuthenticationToken authRequest = new UsernamePasswordAuthenticationToken(username, password);
    // Allow subclasses to set the "details" property
    setDetails(request, authRequest);
    return this.getAuthenticationManager().authenticate(authRequest);
}
```

从`request`的参数中取出用户名和密码，封装成`UsernamePasswordAuthenticationToken`对象，交给`AuthenticationManager`的`authenticate`来做认证，认证成功后，`AuthenticationManager`身份管理器返回一个被填充满了信息的（包括上面提到的权限信息，身份信息，细节信息，但密码通常会被移除）`Authentication`实例。

`AuthenticationManager`是一个接口，认证`Authentication`，如果认证通过之后，返回的`Authentication`应该带上该`principal`所具有的`GrantedAuthority`。

```java
public interface AuthenticationManager {
    Authentication authenticate(Authentication authentication)
            throws AuthenticationException;
}
```

该接口的注释中说明，必须按照如下的异常顺序进行检查和抛出：

* `DisabledException`：账号不可用
* `LockedException`：账号被锁
* `BadCredentialsException`：证书不正确

`AuthenticationManager`是一个接口,其实现类较多，我们先大概看一下继承图，有个基本的认知：