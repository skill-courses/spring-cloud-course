# Spring AOP基本概念

![spring-aop](../../images/spring-basic/spring-aop.webp)

Spring 框架的一个关键组件是**面向切面的编程(AOP)框架**。AOP是Aspect Oriented Programming的缩写，是一种通过预编译(AspectJ)或运行期动态代理(Spring AOP)实现程序功能的统一维护的一种技术。

面向切面的编程需要把程序逻辑分解成不同的部分称为所谓的关注点。跨一个应用程序的多个点的功能被称为横切关注点，这些横切关注点在概念上独立于应用程序的业务逻辑。在软件开发过程中有各种各样的很好的切面的例子，如日志记录、审计、声明式事务、安全性和缓存等。

在OOP中，关键单元模块度是类，而在AOP中单元模块度是切面。依赖注入帮助你对应用程序对象相互解耦合，AOP可以帮助你从它们所影响的对象中对横切关注点解耦。通常认为，AOP是对OOP的一种补充。

![cross-cutting-concern](../../images/spring-basic/cross-cutting-concern.png)

从上图可以看出，***切面实现了横切关注点的模块化！***

从实现层面上来讲，AOP要达到的效果是，保证开发者不修改源代码的前提下，去为系统中的业务组件添加某种通用功能。AOP的本质是由AOP框架修改业务组件的多个方法的源代码，看到这其实应该明白了，AOP其实就是前面一篇文章讲的代理模式的典型应用。按照 AOP 框架修改源代码的时机，可以将其分为两类：
* **静态AOP实现：** AOP框架在编译阶段对程序源代码进行修改，生成了静态的 AOP 代理类（生成的 *.class 文件已经被改掉了，需要使用特定的编译器），比如 AspectJ。
* **动态AOP实现：** AOP框架在运行阶段对动态生成代理对象（在内存中以 JDK 动态代理，或 CGlib 动态地生成 AOP 代理类），如 SpringAOP。##

## Spring AOP的优势

* 纯Java实现，无需特殊的编译过程，不需要控制类加载器层次
* 目前只支持方法执行连接点（通知Spring Bean的方法执行）
* Spring AOP的价值在于，不是为了提供最完整的AOP实现，尽管它的功能非常强大，而是侧重提供一种AOP实现和Spring IOC之间的整合，用于帮助解决企业应用中的常见问题。
* Spring AOP不会与AspectJ竞争，从而提供综合全面的AOP解决方案。

## AOP基本术语

在我们开始使用AOP工作之前，让我们熟悉一下AOP概念和术语。这些术语并不特定于Spring，而是与AOP有关的。

| 名称 | 说明 | 举例 |
| :--: | --- | --- |
| 切面(Aspect) | 一个关注点的模块化，这个关注点可能会横切多个对象。这个模块是有一组具有多个横切需求的APIs组成 | 日志记录可以被认为是一个切面，封装成日志模块，其提供的APIs将会被应用程序的各个层级调用 |
| 连接点(join Point) | 连接点是一个应用执行过程中能够插入一个切面的点。切面代码可以利用这些点插入到应用的正规流程中。| 连接点可以是调用方法时、抛出异常时、甚至修改字段时，比如可以在程序中记录日志的地方 |
| 通知(Advice) | 在切面上面某个特定的连接点上执行的动作，程序执行过程中能够应用通知的所有点。| 常见的通知有五种，后面举例说明。|
| 切点(PointCut) | 切点会匹配通知所要织入的一个或者多个连接点,用于定义定义通知被应用的位置，通常使用明确的类或者方法来指定这些切点。| 在AOP中，通知和一个切入点表达式关联 |
| 引入(Introduction) | 在不修改类代码的前提下，为类添加新的方法和属性 | 无 |
| 目标对象(Target Object) | 被一个或者多个切面所通知的对象 | 无 |


## Advice类型

| 名称 | 说明 | 相关注解 |
| -- | --- | --- |
| 前置通知(Before Advice) | 在某个连接点之前进行的通知，但不能组织连接点前的执行(除非它抛出一个异常) | @before |
| 返回后通知(After Runing Advice) | 在某个连接点正常完成后执行通知 | @after-returning |
| 抛出异常后通知(After Throwing Advice) | 在方法抛出异常退出时执行的通知 | @after-throwing |
| 后通知(After Advice) | 在方法执行后运行通知，无论其结果如何。 | @After |
| 环绕通知(Rround Advice) | 在调用通知方法之前和之后运行通知。 | @Around |


